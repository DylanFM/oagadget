<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Open Australia">
    <Require feature="opensocial-0.8" />
    <Require feature="setprefs" />
  </ModulePrefs>
  <UserPref name="postcode" display_name="Postcode" required="true" />
  <Content type="html" view="nav">
    <![CDATA[

    <div id="app">
    
    </div>

    <script type="text/javascript" src="http://www.google.com/jsapi" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
      google.load("jquery", "1.3.2");
    </script>
		<script type="text/javascript" charset="utf-8">
			(function($) {
			  
			  // Application code
        var prefs = new gadgets.Prefs(),
            app = $("#app"),
            postcode = prefs.getString("postcode"),
            content;

			  var showPostcode = function() {
			    $(app).append("<p>Your postcode is " + postcode + ".</p>");
			  };

        if (postcode) {
          // If there isn't a postcode set, provide a way to set it
          $(app).append("<p>You need to set your postcode.</p>");
          $(app).append("<input type=\"text\" name=\"postcode\" size=\"6\" />");
          $(app).append("<input type=\"submit\" name=\"submit\" id=\"save\" />");
          // Add save functionality to button
          $("#save").click(function(event) {
            // Save the postcode
            postcode = $(this).val();
            prefs.set("postcode", postcode);
            showPostcode();
            return false;
          });
        } else {
          // If there is a postcode set, use the Open Australia API to get their rep
          showPostcode();
        }
			  
			})(jQuery);
		</script>

    ]]>
  </Content>
</Module>